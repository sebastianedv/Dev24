{"filter":false,"title":"lambda_sqs.py","tooltip":"/infra/lambda_sqs.py","undoManager":{"mark":7,"position":7,"stack":[[{"start":{"row":0,"column":0},"end":{"row":51,"column":5},"action":"insert","lines":["import base64","import boto3","import json","import random","import os","","# Frank; This is probalby be closer to what we need in production. Let's get funding first!","","bedrock_client = boto3.client(\"bedrock-runtime\", region_name=\"us-east-1\")","s3_client = boto3.client(\"s3\")","","MODEL_ID = \"amazon.titan-image-generator-v1\"","BUCKET_NAME =  os.environ[\"BUCKET_NAME\"]","","def lambda_handler(event, context):","    # Loop through all SQS records in the event","    for record in event[\"Records\"]:","        # Extract the SQS message body","        prompt = record[\"body\"]","        seed = random.randint(0, 2147483647)","        s3_image_path = f\"images/titan_{seed}.png\"","        # Prepare the request for image generation","        native_request = {","            \"taskType\": \"TEXT_IMAGE\",","            \"textToImageParams\": {\"text\": prompt},","            \"imageGenerationConfig\": {","                \"numberOfImages\": 1,","                \"quality\": \"standard\",","                \"cfgScale\": 8.0,","                \"height\": 512,","                \"width\": 512,","                \"seed\": seed,","            },","        }","","        # Invoke the model","        response = bedrock_client.invoke_model(","            modelId=MODEL_ID,","            body=json.dumps(native_request)","        )","","        model_response = json.loads(response[\"body\"].read())","        base64_image_data = model_response[\"images\"][0]","        image_data = base64.b64decode(base64_image_data)","","        # Upload the image to S3","        s3_client.put_object(Bucket=BUCKET_NAME, Key=s3_image_path, Body=image_data)","","    return {","        \"statusCode\": 200,","        \"body\": json.dumps(\"\")","    }"],"id":1}],[{"start":{"row":20,"column":26},"end":{"row":20,"column":27},"action":"insert","lines":["2"],"id":2},{"start":{"row":20,"column":27},"end":{"row":20,"column":28},"action":"insert","lines":["0"]},{"start":{"row":20,"column":28},"end":{"row":20,"column":29},"action":"insert","lines":["/"]}],[{"start":{"row":29,"column":26},"end":{"row":29,"column":29},"action":"remove","lines":["512"],"id":3},{"start":{"row":29,"column":26},"end":{"row":29,"column":27},"action":"insert","lines":["2"]},{"start":{"row":29,"column":27},"end":{"row":29,"column":28},"action":"insert","lines":["5"]},{"start":{"row":29,"column":28},"end":{"row":29,"column":29},"action":"insert","lines":["6"]}],[{"start":{"row":30,"column":25},"end":{"row":30,"column":28},"action":"remove","lines":["512"],"id":4},{"start":{"row":30,"column":25},"end":{"row":30,"column":26},"action":"insert","lines":["2"]},{"start":{"row":30,"column":26},"end":{"row":30,"column":27},"action":"insert","lines":["5"]},{"start":{"row":30,"column":27},"end":{"row":30,"column":28},"action":"insert","lines":["6"]}],[{"start":{"row":20,"column":29},"end":{"row":20,"column":35},"action":"remove","lines":["images"],"id":5},{"start":{"row":20,"column":29},"end":{"row":20,"column":30},"action":"insert","lines":["g"]},{"start":{"row":20,"column":30},"end":{"row":20,"column":31},"action":"insert","lines":["e"]},{"start":{"row":20,"column":31},"end":{"row":20,"column":32},"action":"insert","lines":["n"]},{"start":{"row":20,"column":32},"end":{"row":20,"column":33},"action":"insert","lines":["e"]},{"start":{"row":20,"column":33},"end":{"row":20,"column":34},"action":"insert","lines":["r"]},{"start":{"row":20,"column":34},"end":{"row":20,"column":35},"action":"insert","lines":["a"]},{"start":{"row":20,"column":35},"end":{"row":20,"column":36},"action":"insert","lines":["t"]},{"start":{"row":20,"column":36},"end":{"row":20,"column":37},"action":"insert","lines":["e"]},{"start":{"row":20,"column":37},"end":{"row":20,"column":38},"action":"insert","lines":["d"]},{"start":{"row":20,"column":38},"end":{"row":20,"column":39},"action":"insert","lines":["_"]},{"start":{"row":20,"column":39},"end":{"row":20,"column":40},"action":"insert","lines":["i"]},{"start":{"row":20,"column":40},"end":{"row":20,"column":41},"action":"insert","lines":["m"]},{"start":{"row":20,"column":41},"end":{"row":20,"column":42},"action":"insert","lines":["a"]},{"start":{"row":20,"column":42},"end":{"row":20,"column":43},"action":"insert","lines":["g"]},{"start":{"row":20,"column":43},"end":{"row":20,"column":44},"action":"insert","lines":["e"]}],[{"start":{"row":20,"column":44},"end":{"row":20,"column":45},"action":"insert","lines":["s"],"id":6}],[{"start":{"row":30,"column":25},"end":{"row":30,"column":28},"action":"remove","lines":["256"],"id":7},{"start":{"row":30,"column":25},"end":{"row":30,"column":26},"action":"insert","lines":["5"]},{"start":{"row":30,"column":26},"end":{"row":30,"column":27},"action":"insert","lines":["1"]},{"start":{"row":30,"column":27},"end":{"row":30,"column":28},"action":"insert","lines":["2"]}],[{"start":{"row":29,"column":26},"end":{"row":29,"column":29},"action":"remove","lines":["256"],"id":8},{"start":{"row":29,"column":26},"end":{"row":29,"column":27},"action":"insert","lines":["5"]},{"start":{"row":29,"column":27},"end":{"row":29,"column":28},"action":"insert","lines":["1"]},{"start":{"row":29,"column":28},"end":{"row":29,"column":29},"action":"insert","lines":["2"]}]]},"ace":{"folds":[],"scrolltop":0,"scrollleft":0,"selection":{"start":{"row":29,"column":29},"end":{"row":29,"column":29},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":0},"timestamp":1732382551456,"hash":"eaaf6f8e09235300d1052328ecaa4aacc88204a8"}